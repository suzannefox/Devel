---
title: "Dataset report of a burrow data file"
author: "Suzanne Fox"
date: "February 2017"
output: word_document
df_print: kable
---

```{r setup, echo=FALSE,  message=FALSE, warning=FALSE}

knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
#library(cowplot)

workdir <- "C:/Users/Suzanne/OneDrive - Suzanne Fox/Dissertation/R/"

setwd(workdir)

Data.source <- read.csv("TestData.csv", stringsAsFactors = FALSE)
#Data.source <- iris
Data.burrow <- read.csv("TestBurrow.csv", stringsAsFactors = FALSE)

```

## Dataset details


```{r structure, echo=FALSE, comment="", collapse=TRUE}
# Dataset name
Data.name <- subset(Data.burrow, InfoLevel=="DATASET" &  InfoType=="SOURCEDATA",
c("InfoDetail"))
cat(paste("Source data name -", Data.name))

# Description
Data.description <- subset(Data.burrow, InfoLevel=="DATASET" & InfoType=="SOURCE",
c("InfoDetail"))
cat(paste("Source data description -", Data.description))

# Run time
Data.rundate <- subset(Data.burrow, InfoLevel=="HEADER" & InfoType=="RUN DATE",
c("InfoDetail"))
cat(paste("Burrow data created -", Data.rundate))

# Dataset structure ================================================

numcols <- subset(Data.burrow, Variable1=="NUMCOLS", c("myData1"))
numrows <- subset(Data.burrow, Variable1=="NUMROWS", c("myData1"))
outtext <- sprintf("Dataset dimensions - %s columns (variables) and %s rows (cases)",numcols, numrows)

cat(outtext)
```

## Best Guess at datatype for each variable


```{r datatypes, echo=FALSE, comment="", collapse=TRUE}
Data.bestguess <- subset(Data.burrow, InfoType=="BEST GUESS", select=c("Variable1","myData1"))
names(Data.bestguess) <- c("Variable","Datatype")

print(Data.bestguess, row.names=FALSE)

```

## Variable analysis - level of missing values


```{r missing, echo=FALSE, comment="", fig.width=9, fig.height=6, collapse=TRUE}
Data.missing <- subset(Data.burrow, InfoDetail=="DENSITY_NA", select=c("Variable1","myData1"))
Data.missing$myData1 <- as.numeric(Data.missing$myData1) * 100
names(Data.missing) <- c("Variable","Missing")

# See if there are any missing, and find max level
Missing.total <- sum(Data.missing$Missing)
Missing.max <- max(Data.missing$Missing)

if (Missing.total==0) {
  cat("There were no missing values for any variable")
} else {
  ggplot(data=Data.missing, 
       aes(x=Variable,  y=Missing)) +
       geom_bar(colour="black", fill="#4C1E9C",
       width=.8, stat="identity") +
       xlab("Variables") + ylab("% of Total Sample") +
       ggtitle("Overview of Missing Values") +
       theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
}

```

## Variable analysis - level of unique values


```{r uniques, echo=FALSE, comment="", collapse=TRUE, fig.width=9, fig.height=6}
Data.unique <- subset(Data.burrow, InfoDetail=="DENSITY_UNIQUES", select=c("Variable1","myData1"))
Data.unique$myData1 <- as.numeric(Data.unique$myData1) * 100
names(Data.unique) <- c("Variable","Unique")

ggplot(data=Data.unique, 
       aes(x=Variable,  y=Unique)) +
       geom_bar(colour="black", fill="#4C1E9C",
       width=.8, stat="identity") +
       xlab("Variables") + ylab("% of Total Sample") +
       ggtitle("Overview of Unique Values") +
       theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))

```

## Variable analysis - distributions and outliers for numeric variables

```{r temp, echo=FALSE, comment="", collapse=TRUE}

# 
# if (sum(burrow.report$Missing)==0) {
#   print("There were no missing values for any variable")
# } else {
#   print("Dealing with missing data")
# }
# 
# #plotvar <- "mpg"
# #myPlot_Int(mtcars,plotvar)
# 
# num.histograms <- nrow(burrow.plothist)
# print(paste("There are",num.histograms,"numeric fields."))
# 
# for (i in seq_len(num.histograms)) {
#   plotvar <- burrow.plothist[i,c("VariableName")]
#   print(paste("Plotting",plotvar))
# 
#   possibleError <- tryCatch(
#     myPlot <- myPlot_Int(burrow.inputdata,plotvar),
#     error=function(e) e
#   )
# 
#   if(inherits(possibleError, "error")) {
#     print(paste("error plotting",plotvar))
#     next
#   }
# 
#   print(myPlot)
# }

```